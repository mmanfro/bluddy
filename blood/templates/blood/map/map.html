{% extends 'blood/base.html' %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'blood/css/map/map.css' %}" type="text/css" />
{% endblock %}

{% block content %}

    <!-- Dynamic search input -->
    <input id="search" class="form-control" placeholder="Buscar" type="text" onkeyup="search()" style="position: absolute; height: 35px; width: 97.5%">

    <!-- Places list -->
    <div id="places" class="overflowHiddenButFunctional">
        <div class="place">
            <div style="float: left;  display: flex; flex-direction: column; align-items: center; margin-right: 10px; width: 50px">
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                    viewBox="0 0 612 612" style="enable-background:new 0 0 612 612;" xml:space="preserve"
                    width="32" height="32" fill="var(--primary-color)">
                    <path d="M306.002,175.399c-3.49,0-6.815,1.483-9.143,4.079c-7.238,8.065-70.709,79.975-70.709,120.816
                        c0,44.03,35.822,79.852,79.852,79.852s79.852-35.822,79.852-79.852c0-40.84-63.471-112.751-70.707-120.814
                        C312.816,176.882,309.491,175.399,306.002,175.399z M255.89,291.803c0,0,4.489,15.99,22.544,34.044
                        c18.055,18.055,34.042,22.546,34.042,22.546C280.074,362.372,241.375,324.432,255.89,291.803z"/>
                    <path d="M406.903,36.095h-32.617C360.37,13.706,338.257,0,314.358,0h-16.713c-23.899,0-46.012,13.706-59.927,36.095H205.1
                        c-53.782,0-97.537,43.753-97.537,97.535v288.281c0,53.782,43.755,97.535,97.537,97.535h141.048v70.09
                        c0,12.405,10.057,22.463,22.461,22.463s22.461-10.058,22.461-22.463v-70.09H406.9c53.782,0,97.537-43.753,97.537-97.535V133.631
                        C504.438,79.85,460.683,36.095,406.903,36.095z M297.645,30.03h16.712c6.784,0,13.388,2.161,19.358,6.066h-55.425
                        C284.259,32.19,290.863,30.03,297.645,30.03z M459.516,421.912c0,29.01-23.603,52.611-52.613,52.611H205.102
                        c-29.01,0-52.613-23.601-52.613-52.611V133.631c0-29.009,23.603-52.611,52.613-52.611h201.801
                        c29.01,0,52.613,23.601,52.613,52.611V421.912z"/>
                </svg>
                <span style="font-size: 14px; color: var(--complementary-color)">4,6km</span>
            </div>
            <div style="height: 100%; display: flex; align-items:center; justify-content:center;">
                <a style="width: 100%;" target="_blank" href="http://maps.google.com/?q=Banco de Sangue de São Paulo">
                    <span name="placeName" style="font-size: 16px; ">Banco de Sangue de São Paulo</span>
                </a>
                <div onclick="favorite(true, '{{x}}')" id="nonFavorite{{x}}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="var(--primary-color)" class="bi bi-star" viewBox="0 0 16 16"
                        style="margin-top: -2.5%">
                        <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                    </svg>
                </div>
                <div onclick="favorite(false, '{{x}}')" id="favorite{{x}}" style="display: none">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="var(--primary-color)" class="bi bi-star-fill" viewBox="0 0 16 16"
                        style="margin-top: -2.5%; ">
                        <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.283.95l-3.523 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Places list -->
        {% for x in '01234567891011121314151617181920' %}
            <div class="place">
                <div style="float: left;  display: flex; flex-direction: column; align-items: center; margin-right: 10px; width: 50px">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                        viewBox="0 0 612 612" style="enable-background:new 0 0 612 612;" xml:space="preserve"
                        width="32" height="32" fill="var(--primary-color)">
                        <path d="M306.002,175.399c-3.49,0-6.815,1.483-9.143,4.079c-7.238,8.065-70.709,79.975-70.709,120.816
                            c0,44.03,35.822,79.852,79.852,79.852s79.852-35.822,79.852-79.852c0-40.84-63.471-112.751-70.707-120.814
                            C312.816,176.882,309.491,175.399,306.002,175.399z M255.89,291.803c0,0,4.489,15.99,22.544,34.044
                            c18.055,18.055,34.042,22.546,34.042,22.546C280.074,362.372,241.375,324.432,255.89,291.803z"/>
                        <path d="M406.903,36.095h-32.617C360.37,13.706,338.257,0,314.358,0h-16.713c-23.899,0-46.012,13.706-59.927,36.095H205.1
                            c-53.782,0-97.537,43.753-97.537,97.535v288.281c0,53.782,43.755,97.535,97.537,97.535h141.048v70.09
                            c0,12.405,10.057,22.463,22.461,22.463s22.461-10.058,22.461-22.463v-70.09H406.9c53.782,0,97.537-43.753,97.537-97.535V133.631
                            C504.438,79.85,460.683,36.095,406.903,36.095z M297.645,30.03h16.712c6.784,0,13.388,2.161,19.358,6.066h-55.425
                            C284.259,32.19,290.863,30.03,297.645,30.03z M459.516,421.912c0,29.01-23.603,52.611-52.613,52.611H205.102
                            c-29.01,0-52.613-23.601-52.613-52.611V133.631c0-29.009,23.603-52.611,52.613-52.611h201.801
                            c29.01,0,52.613,23.601,52.613,52.611V421.912z"/>
                    </svg>
                    <span style="font-size: 14px; color: var(--complementary-color)">11,2km</span>
                </div>
                <div style=" height: 100%; display: flex; align-items:center; justify-content:center;">
                    <a style="width: 100%;" target="_blank" href="http://maps.google.com/?q=Banco de Sangue - Unidade Einstein Morumbi">
                        <span name="placeName" style="font-size: 16px;">Banco de Sangue - Unidade Einstein Morumbi</span>
                    </a>
                    <div onclick="favorite(true, '{{x}}')" id="nonFavorite{{x}}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="var(--primary-color)" class="bi bi-star" viewBox="0 0 16 16"
                            style="margin-top: -2.5%">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                        </svg>
                    </div>
                    <div onclick="favorite(false, '{{x}}')" id="favorite{{x}}" style="display: none">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="var(--primary-color)" class="bi bi-star-fill" viewBox="0 0 16 16"
                            style="margin-top: -2.5%; ">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.283.95l-3.523 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                        </svg>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <script>
        /*
            Search
        */
        function search() {
            document.getElementById("places").scrollTop = 0;

            const input = document.getElementById("search");
            const places = document.getElementsByName("placeName");
            const filter = input.value.toUpperCase();

            // Loop through all table rows, and hide those who don't match the search query
            for (var i = 0; i < places.length; i++) {
                const placeName = places[i].textContent || places[i].innerText
                const placeHolder = places[i].parentElement.parentElement;

                if (placeName) {
                    if (placeName.toUpperCase().indexOf(filter) > -1) {
                        placeHolder.style.display = "";
                    } else {
                        placeHolder.style.display = "none";
                    }
                }
            }
        }


        /* 
            Favorite    
        */
        var timer;
        
        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms))
        }

        async function favorite(action, id) {
            
            document.getElementById(action ? 'nonFavorite'+id : 'favorite'+id).style.display = 'none'
            document.getElementById(action ? 'favorite'+id : 'nonFavorite'+id).style.display = ''

            // Loading
            const loading = document.getElementById("loading")
            loading.style.display = 'block'
            await wait(2000);
            loading.style.display = 'none'

            /*
                Toast notification
            */

            // Get the toast DIV
            const toast = document.getElementById("toast")

            // Try  to hide (maybe it's visible)
            toast.className.replace("show", "")

            // Change message between 'added' and 'removed' favorite
            toast.innerHTML = action ? 'Adicionado aos favoritos!' : 'Removido dos favoritos'

            // Add the "show" class to DIV
            toast.className = "show"

            // After 2 seconds, remove the show class from DIV
            timer = setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 2000)
        }
    </script>

    {% comment %} <!--The div element for the map -->
    <div id="map" style="height: 100%;"></div>

    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDqR5wJLAQqcUl9-7ol-dmpDgveZGnNLZE&callback=initMap&libraries=&v=weekly"
      async
    ></script>

    <script type="text/javascript">
        // Initialize and add the map
        function initMap() {

            // The location of Sao Paulo
            const saopaulo = { lat: -23.5972867, lng: -46.6817137 };

            // The map, centered at Sao Paulo
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 12,
                center: saopaulo,
            });

            // The marker, positioned at Sao Paulo
            const marker = new google.maps.Marker({
                position: saopaulo,
                map: map,
            });
        }
    </script> {% endcomment %}
{% endblock %}